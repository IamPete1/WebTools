<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>ArduPilot S-Curve Kinematic Tool</title>
<link rel="icon" href="../images/AP_favicon.png">
<script type="text/javascript" src="AutorotationTool.js"></script>
<script type="text/javascript" src="../Libraries/FileSaver.js"></script>
<script type="text/javascript" src="../Libraries/Array_Math.js"></script>
<script type="text/javascript" src="../Libraries/Param_Helpers.js"></script>
<script type="text/javascript" src="../Libraries/Plotly_helpers.js"></script>
<script type="text/javascript" src="../Libraries/ParameterMetadata.js"></script>

<script src='../modules/plotly.js/dist/plotly.min.js'></script>

<script src="../modules/build/floating-ui/dist/umd/popper.min.js"></script>
<script src="../modules/build/tippyjs/dist/tippy-bundle.umd.min.js"></script>

</head>
<table style="width:1200px"><tr><td>
  <a href="https://ardupilot.org"><img src="../images/ArduPilot.png"></a>
</td><td>
  <a href="https://github.com/ArduPilot/WebTools"><img src="../images/github-mark.png" style="width:60px"></a>
  <br>
  <a href="https://github.com/ArduPilot/WebTools"><img src="../images/GitHub_Logo.png" style="width:60px"></a>
</td></tr></table>

<style>
  div.plotly-notifier {
    visibility: hidden;
  }
</style>

<h1><a href="" style="color: #000000; text-decoration:none;">S-Curve Trajectory Viewer Tool</a></h1>

<body onload="initial_load(); run_flare()">
<table>
  <tr>
    <td>
      <fieldset style="width:245px;height:120px">
        <legend>Position 1
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='Waypoint that the vehicle is moving away from',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="last_wp_x" value="30" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="last_wp_x">North (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="last_wp_y" value="0" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="last_wp_y">East (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="last_wp_z" value="50" min="0" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="last_wp_z">Up (m)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:245px;height:120px">
        <legend>Position 2
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='Waypoint that the vehicle is moving toward',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="curr_wp_x" value="50" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="curr_wp_x">North (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="curr_wp_y" value="50" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="curr_wp_y">East (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="curr_wp_z" value="50" min="0" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="curr_wp_z">Up (m)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:245px;height:120px">
        <legend>Position 3
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='Next waypoint in mission sequence, after current is waypoint is achieved',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="next_wp_x" value="70" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="next_wp_x">North (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="next_wp_y" value="20" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="next_wp_y">East (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="next_wp_z" value="40" min="0" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="next_wp_z">Up (m)</label>
        </p>
      </fieldset>
    </td>

  </tr>
</table>
<table>
  <tr>
    <td>
      <fieldset style="width:245px;height:120px">
        <legend>Initial Conditions
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='The measurements at the begining of the flare phase',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="inital_accel" value="3" min="0" step="0.1" max="10" style="width: 50px" onchange="run_flare()">
          <label for="inital_accel">Acceleration (m/s²) (A0)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="initial_vel" value="-11" min="-20" step="0.5" max="-0.5" style="width: 50px" onchange="run_flare()">
          <label for="initial_vel">Velocity (m/s) (V0)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="initial_pos" value="10" min="0.5" step="0.5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="initial_pos">Position (m) (P0)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:245px;height:120px">
        <legend>Final Conditions
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='The measurements at the end of the flare phase, as the vehicle transitions in to the touchdown phase.',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="final_accel" value="0" min="0" step="0.1" max="10" style="width: 50px" onchange="run_flare()">
          <label for="final_accel">Acceleration (m/s²) (AF)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="final_vel" value="0" min="-20" step="0.5" max="0" style="width: 50px" onchange="run_flare()">
          <label for="final_vel">Velocity (m/s) (VF)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="final_pos" value="0" min="0.5" step="0.5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="final_pos">Position (m) (PF)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:300px;height:240px">
        <legend>Parameters
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='The parameter values that the user has to define the curve',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="snap_max" value="2" min="1" step="0.1" max="15" style="width: 50px" onchange="run_flare()">
          <label for="snap_max">Snap Max (m/s4)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="max_jerk" value="13" min="1.0" step="0.5" max="30" style="width: 50px" onchange="run_flare()">
          <label for="max_jerk">Max Jerk Mag (m/s³)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="accel_z_max" value="9.5" min="1.0" step="0.1" max="30" style="width: 50px" onchange="run_flare()">
          <label for="accel_z_max">Max Vert Accel Mag (m/s²)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="accel_xy_max" value="9.5" min="1.0" step="0.1" max="30" style="width: 50px" onchange="run_flare()">
          <label for="accel_xy_max">Max XY Accel Mag (m/s²)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="speed_xy_max" value="9.5" min="1.0" step="0.1" max="30" style="width: 50px" onchange="run_flare()">
          <label for="speed_xy_max">Max XY Speed (m/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="speed_z_up" value="9.5" min="1.0" step="0.1" max="30" style="width: 50px" onchange="run_flare()">
          <label for="speed_z_up">Max Speed Up (m/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="speed_z_down" value="9.5" min="1.0" step="0.1" max="30" style="width: 50px" onchange="run_flare()">
          <label for="speed_z_down">Max Speed Down (m/s)</label>
        </p>

      </fieldset>
    </td>

  </tr>
</table>

<div id="waypoint_plot" style="width:600px;height:600px"></div>
<div id="jerk_plot" style="width:1200px;height:300px"></div>
<div id="accel_plot" style="width:1200px;height:300px"></div>
<div id="vel_plot" style="width:1200px;height:300px"></div>
<div id="pos_plot" style="width:1200px;height:300px"></div>


<script>

  window.onerror = function(msg, url, linenumber) {
      alert('Sorry, something went wrong.\n\n' + 
            'Please try a hard reload of this page to clear its cache.\n\n' +
            'If the error persists open an issue on the GitHub repo.\n' +
            'Include a copy of the log and the following error message:\n\n' +
            msg + '\n' +
            'URL: '+ url +'\n' +
            'Line Number: '+ linenumber)
      return false
  }
  window.addEventListener('unhandledrejection', function (e) {
    throw new Error(e.reason.stack)
  })

  // Load tool tips
  tippy('#TT')

</script>

</body>
</html>
