<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>ArduPilot S-Curve Kinematic Tool</title>
<link rel="icon" href="../images/AP_favicon.png">
<script type="text/javascript" src="AutorotationTool.js"></script>
<script type="text/javascript" src="../Libraries/FileSaver.js"></script>
<script type="text/javascript" src="../Libraries/Array_Math.js"></script>
<script type="text/javascript" src="../Libraries/Param_Helpers.js"></script>
<script type="text/javascript" src="../Libraries/Plotly_helpers.js"></script>
<script type="text/javascript" src="../Libraries/ParameterMetadata.js"></script>

<script src='../modules/plotly.js/dist/plotly.min.js'></script>

<script src="../modules/build/floating-ui/dist/umd/popper.min.js"></script>
<script src="../modules/build/tippyjs/dist/tippy-bundle.umd.min.js"></script>

</head>
<table style="width:1200px"><tr><td>
  <a href="https://ardupilot.org"><img src="../images/ArduPilot.png"></a>
</td><td>
  <a href="https://github.com/ArduPilot/WebTools"><img src="../images/github-mark.png" style="width:60px"></a>
  <br>
  <a href="https://github.com/ArduPilot/WebTools"><img src="../images/GitHub_Logo.png" style="width:60px"></a>
</td></tr></table>

<style>
  div.plotly-notifier {
    visibility: hidden;
  }
</style>

<h1><a href="" style="color: #000000; text-decoration:none;">S-Curve Trajectory Viewer Tool</a></h1>

<body onload="initial_load(); run_flare()">
<table>
  <tr>
    <td>
      <fieldset style="width:150px;height:100px">
        <legend>Position 1
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='Waypoint that the vehicle is moving away from',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="first_wp_y" value="0" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="first_wp_y">North (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="first_wp_x" value="0" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="first_wp_x">East (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="first_wp_z" value="50" min="0" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="first_wp_z">Up (m)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:150px;height:100px">
        <legend>Position 2
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='Waypoint that the vehicle is moving toward',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="curr_wp_y" value="300" min="-100" step="5" max="1000" style="width: 50px" onchange="run_flare()">
          <label for="curr_wp_y">North (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="curr_wp_x" value="200" min="-100" step="5" max="1000" style="width: 50px" onchange="run_flare()">
          <label for="curr_wp_x">East (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="curr_wp_z" value="50" min="0" step="5" max="1000" style="width: 50px" onchange="run_flare()">
          <label for="curr_wp_z">Up (m)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:150px;height:100px">
        <legend>Position 3
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='Next waypoint in mission sequence, after current is waypoint is achieved',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="next_wp_y" value="70" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="next_wp_y">North (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="next_wp_x" value="35" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="next_wp_x">East (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="next_wp_z" value="40" min="0" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="next_wp_z">Up (m)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:150px;height:100px">
        <legend>Position 4
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='Next waypoint in mission sequence, after current is waypoint is achieved',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="last_wp_y" value="100" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="last_wp_y">North (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="last_wp_x" value="20" min="-100" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="last_wp_x">East (m)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="last_wp_z" value="40" min="0" step="5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="last_wp_z">Up (m)</label>
        </p>
      </fieldset>
    </td>

  </tr>
</table>
<table>
  <tr>
    <td>
      <fieldset style="width:245px;height:120px">
        <legend>Initial Conditions
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='The measurements at the begining of the flare phase',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="inital_accel" value="3" min="0" step="0.1" max="10" style="width: 50px" onchange="run_flare()">
          <label for="inital_accel">Acceleration (m/s²) (A0)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="initial_vel" value="-11" min="-20" step="0.5" max="-0.5" style="width: 50px" onchange="run_flare()">
          <label for="initial_vel">Velocity (m/s) (V0)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="initial_pos" value="10" min="0.5" step="0.5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="initial_pos">Position (m) (P0)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:245px;height:120px">
        <legend>Final Conditions
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='The measurements at the end of the flare phase, as the vehicle transitions in to the touchdown phase.',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="final_accel" value="0" min="0" step="0.1" max="10" style="width: 50px" onchange="run_flare()">
          <label for="final_accel">Acceleration (m/s²) (AF)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="final_vel" value="0" min="-20" step="0.5" max="0" style="width: 50px" onchange="run_flare()">
          <label for="final_vel">Velocity (m/s) (VF)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="final_pos" value="0" min="0.5" step="0.5" max="100" style="width: 50px" onchange="run_flare()">
          <label for="final_pos">Position (m) (PF)</label>
        </p>
      </fieldset>
    </td>

    <td>
      <fieldset style="width:300px;height:600px">
        <legend>Parameters
            <img id="TT" src="../images/question-circle.svg" style="width: 1em; vertical-align: bottom" 
            data-tippy-content='The parameter values that the user has to define the curve',
            data-tippy-maxWidth='750px'/>
        </legend>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="psc_max_jerk_xy" value="5.0" min="1.0" step="0.5" max="20.0" style="width: 50px" onchange="run_flare()">
          <label for="psc_max_jerk_xy">PSC_JERK_XY (m/s³)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="psc_max_jerk_z" value="5.0" min="5.0" step="0.5" max="50.0" style="width: 50px" onchange="run_flare()">
          <label for="psc_max_jerk_z">PSC_JERK_Z (m/s³)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="wpnav_max_jerk" value="1.0" min="1.0" step="0.5" max="20.0" style="width: 50px" onchange="run_flare()">
          <label for="wpnav_max_jerk">WPNAV_JERK (m/s³)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="wpnav_accel_z_max" value="100" min="50" step="50" max="500" style="width: 50px" onchange="run_flare()">
          <label for="wpnav_accel_z_max">WPNAV_ACCEL_Z (cm/s²)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="wpnav_accel_xy_max" value="250" min="50" step="50" max="500" style="width: 50px" onchange="run_flare()">
          <label for="wpnav_accel_xy_max">WPNAV_ACCEL (cm/s²)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="wpnav_accel_c_max" value="250" min="50" step="50" max="500" style="width: 50px" onchange="run_flare()">
          <label for="wpnav_accel_c_max">WPNAV_ACCEL_C (cm/s²)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="wpnav_speed_xy_max" value="1000" min="10" step="10" max="2000" style="width: 50px" onchange="run_flare()">
          <label for="wpnav_speed_xy_max">WPNAV_SPEED (cm/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="wpnav_speed_z_up" value="250" min="10" step="10" max="1000" style="width: 50px" onchange="run_flare()">
          <label for="wpnav_speed_z_up">WPNAV_SPEED_UP (cm/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="wpnav_speed_z_dn" value="150" min="10" step="10" max="500" style="width: 50px" onchange="run_flare()">
          <label for="wpnav_speed_z_dn">WPNAV_SPEED_DN (cm/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="wpnav_radius" value="200" min="5" step="50" max="1000" style="width: 50px" onchange="run_flare()">
          <label for="wpnav_radius">WPNAV_RADIUS (cm)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="psc_lean_angle_max" value="0" min="0" step="1" max="45" style="width: 50px" onchange="run_flare()">
          <label for="psc_lean_angle_max">PSC_ANGLE_MAX (deg)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="psc_target_filter_cutoff" value="0" min="0" step="1" max="50" style="width: 50px" onchange="run_flare()">
          <label for="psc_target_filter_cutoff">PSC_ACCZ_FLTT (Hz)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="psc_error_filter_cutoff" value="0" min="0" step="1" max="50" style="width: 50px" onchange="run_flare()">
          <label for="psc_error_filter_cutoff">PSC_ACCZ_FLTE (Hz)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="lean_angle_max" value="3000" min="1000" step="100" max="8000" style="width: 50px" onchange="run_flare()">
          <label for="lean_angle_max">ANGLE_MAX (cdeg)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="atc_accel_roll_max" value="110000" min="0" step="30000" max="162000" style="width: 50px" onchange="run_flare()">
          <label for="atc_accel_roll_max">ATC_ACCEL_R_MAX (cdeg/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="atc_accel_pitch_max" value="110000" min="0" step="30000" max="162000" style="width: 50px" onchange="run_flare()">
          <label for="atc_accel_pitch_max">ATC_ACCEL_P_MAX (cdeg/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="atc_roll_rate_max" value="0" min="0" step="60" max="360" style="width: 50px" onchange="run_flare()">
          <label for="atc_roll_rate_max">ATC_RATE_R_MAX (deg/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="atc_pitch_rate_max" value="0" min="0" step="60" max="360" style="width: 50px" onchange="run_flare()">
          <label for="atc_pitch_rate_max">ATC_RATE_P_MAX (deg/s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="atc_input_tc" value="0.15" min="0.05" step="0.05" max="0.5" style="width: 50px" onchange="run_flare()">
          <label for="atc_input_tc">ATC_INPUT_TC (s)</label>
        </p>

        <p style="margin-top:5px; margin-bottom:5px;">
          <input type="number" id="atc_rate_ff_enable" value="1" min="0" step="1" max="1" style="width: 50px" onchange="run_flare()">
          <label for="atc_rate_ff_enable">ATC_RATE_FF_ENAB</label>
        </p>

      </fieldset>
    </td>

  </tr>
</table>

<div id="waypoint_plot" style="width:600px;height:600px"></div>
<div id="jerk_plot" style="width:1200px;height:300px"></div>
<div id="accel_plot" style="width:1200px;height:300px"></div>
<div id="vel_plot" style="width:1200px;height:300px"></div>
<div id="pos_plot" style="width:1200px;height:300px"></div>


<script>

  window.onerror = function(msg, url, linenumber) {
      alert('Sorry, something went wrong.\n\n' + 
            'Please try a hard reload of this page to clear its cache.\n\n' +
            'If the error persists open an issue on the GitHub repo.\n' +
            'Include a copy of the log and the following error message:\n\n' +
            msg + '\n' +
            'URL: '+ url +'\n' +
            'Line Number: '+ linenumber)
      return false
  }
  window.addEventListener('unhandledrejection', function (e) {
    throw new Error(e.reason.stack)
  })

  // Load tool tips
  tippy('#TT')

</script>

</body>
</html>
